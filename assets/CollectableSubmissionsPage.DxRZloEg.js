import{d as A,W as N,X as Q,e as y,c as S,a as e,S as c,R as _,o as p,n as m,U as u,Q as t,k as j,P as I,F as E,Y as O,r as P,w as Y,q as Z,y as H,Z as z}from"./vendor.Bn-7_sVg.js";import{R as K}from"./RouterCard.4EuP17xZ.js";import{j as ee,X as C,g as k,k as te,F as se,_ as ae,b as re,c as oe,l as le,m as R,I as V,d as W,a as D,e as T,f as ie,h as ne,u as ce,n as B,M as ue,i as de}from"./index.Cask5RuP.js";import{I as F,S as _e}from"./StatisticsPanel.PdE0uZBz.js";import{a2 as X,p as me,af as pe}from"./icons.BPYJy1hK.js";import"./CraftStatistics.B9m63Ejw.js";const L={crafterScripLesser:33913,crafterScripGreater:41784},ve={class:"panel-wrapper"},fe={class:"card-title-text"},ge={class:"item-selection-container"},we={class:"card-title"},he={class:"title"},be={class:"target-card-container"},ke={class:"item"},Se={class:"item"},xe={class:"item"},je={class:"submission-reward-container"},Ie={key:1},ye={class:"item require-amount-container"},Ce={class:"title"},Ue={class:"amount"},qe={class:"require-amount"},Ge={class:"card-title"},Le={class:"title"},Me={class:"target-card-container"},$e={class:"item"},Ee={class:"item"},Oe={class:"item"},Pe={class:"submission-reward-container"},We={key:1},De={class:"item require-amount-container"},Je={class:"title"},Ne={class:"amount"},ze={class:"require-amount"},Re={class:"actions"},Ve={class:"flex-vac gap-2"},Be={class:"item-selection-container"},Fe={class:"card-title"},Xe={class:"title"},Ae={class:"item-btn-container"},Te={class:"card-title"},Qe={class:"title"},Ye={class:"item-btn-container"},Ze={class:"actions"},He=A({__name:"ItemSelectionPanel",props:N({targetData:{}},{workState:{required:!0},workStateModifiers:{}}),emits:N(["joinWorkflow"],["update:workState"]),setup(U,{emit:q}){const o=j("t"),M=j("userConfig");j("funcConfig");const{uiLanguage:$,itemLanguage:G}=ee(M),n=Q(U,"workState"),l=q,w=y(()=>{const h=[],a=[],v={};Object.values(C).forEach(r=>{r.rewardScrip===L.crafterScripGreater?h.push(r.id):r.rewardScrip===L.crafterScripLesser?a.push(r.id):console.warn("unknown item",r);const s=k(r.id);v[s.craftInfo.jobId]??=[],v[s.craftInfo.jobId].push(r.id)});const g=Object.entries(v).map(([r,s])=>{const d=s.map(i=>C[i]);return{job:te[Number(r)],group1Items:d.filter(i=>b(i.levels,91,100)).map(i=>i.id),group2Items:d.filter(i=>b(i.levels,81,90)).map(i=>i.id),totalCount:d.length}});return g.sort((r,s)=>r.job.job_id-s.job.job_id),{greaterOptions:h,lesserOptions:a,scripGreater:k(L.crafterScripGreater),scripLesser:k(L.crafterScripLesser),freeItemGroups:g};function b(r,s,d){let i=!0;return r.forEach(x=>{x>=s&&x<=d||(i=!1)}),i}}),J=()=>{for(const h in n.value.free.itemSelected)n.value.free.itemSelected[h]=0},f=()=>{l("joinWorkflow")};return(h,a)=>{const v=le,g=oe,b=re,r=ae;return p(),S("div",ve,[e("div",null,[c(se,{"card-key":"ft-item-selection"},{header:_(()=>[a[6]||(a[6]=e("i",{class:"xiv square-1"},null,-1)),e("span",fe,u(t(o)("cs_helper.select_collectable_submission")),1)]),default:_(()=>[c(r,{value:n.value.mode,"onUpdate:value":a[5]||(a[5]=s=>n.value.mode=s),type:"segment",animated:""},{default:_(()=>[c(b,{name:"target"},{tab:_(()=>[e("div",null,[a[7]||(a[7]=e("i",{class:"xiv e05e"},null,-1)),m(" "+u(t(o)("cs_helper.mode.target")),1)])]),default:_(()=>[e("div",ge,[c(g,{size:"small"},{header:_(()=>[e("div",we,[c(W,{size:16,src:t(w).scripGreater.iconUrl},null,8,["src"]),e("span",he,u(t(w).scripGreater[`name_${t(G)}`]),1)])]),default:_(()=>[e("div",be,[e("div",ke,[a[8]||(a[8]=e("i",{class:"xiv e05e"},null,-1)),m(" "+u(t(o)("cs_helper.action.target_scrip_amount"))+" ",1),c(v,{value:n.value.target.greater.scrip,"onUpdate:value":a[0]||(a[0]=s=>n.value.target.greater.scrip=s),min:0,max:9999999},null,8,["value"])]),e("div",Se,[a[9]||(a[9]=e("i",{class:"xiv collectables"},null,-1)),m(" "+u(t(o)("cs_helper.action.craft_target"))+" ",1),c(R,{"model-value":n.value.target.greater.item,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.target.greater.item=s),"dont-clean-after-select":"","options-preset":"custom",options:t(w).greaterOptions},null,8,["model-value","options"])]),e("div",xe,[a[10]||(a[10]=e("i",{class:"xiv crystal"},null,-1)),m(" "+u(t(o)("cs_helper.action.reward"))+" ",1),e("div",je,[n.value.target.greater.item?(p(),I(V,{key:0,"item-info":t(k)(n.value.target.greater.item)},null,8,["item-info"])):(p(),S("div",Ie,u(t(o)("cs_helper.message.select_craft_target_first")),1))])]),e("div",ye,[e("div",Ce,[a[11]||(a[11]=e("i",{class:"xiv arrow-right"},null,-1)),m(" "+u(t(o)("cs_helper.action.need_craft")),1)]),e("div",Ue,[e("span",qe,u(U.targetData.requireGreater),1),m(" "+u(t(o)("common.unit.ge")),1)])])])]),_:1}),c(g,{size:"small"},{header:_(()=>[e("div",Ge,[c(W,{size:16,src:t(w).scripLesser.iconUrl},null,8,["src"]),e("span",Le,u(t(w).scripLesser[`name_${t(G)}`]),1)])]),default:_(()=>[e("div",Me,[e("div",$e,[a[12]||(a[12]=e("i",{class:"xiv e05e"},null,-1)),m(" "+u(t(o)("cs_helper.action.target_scrip_amount"))+" ",1),c(v,{value:n.value.target.lesser.scrip,"onUpdate:value":a[2]||(a[2]=s=>n.value.target.lesser.scrip=s),min:0,max:9999999},null,8,["value"])]),e("div",Ee,[a[13]||(a[13]=e("i",{class:"xiv collectables"},null,-1)),m(" "+u(t(o)("cs_helper.action.craft_target"))+" ",1),c(R,{"model-value":n.value.target.lesser.item,"onUpdate:modelValue":a[3]||(a[3]=s=>n.value.target.lesser.item=s),"dont-clean-after-select":"","options-preset":"custom",options:t(w).lesserOptions},null,8,["model-value","options"])]),e("div",Oe,[a[14]||(a[14]=e("i",{class:"xiv crystal"},null,-1)),m(" "+u(t(o)("cs_helper.action.reward"))+" ",1),e("div",Pe,[n.value.target.lesser.item?(p(),I(V,{key:0,"item-info":t(k)(n.value.target.lesser.item)},null,8,["item-info"])):(p(),S("div",We,u(t(o)("cs_helper.message.select_craft_target_first")),1))])]),e("div",De,[e("div",Je,[a[15]||(a[15]=e("i",{class:"xiv arrow-right"},null,-1)),m(" "+u(t(o)("cs_helper.action.need_craft")),1)]),e("div",Ne,[e("span",ze,u(U.targetData.requireLesser),1),m(" "+u(t(o)("common.unit.ge")),1)])])])]),_:1})]),e("div",Re,[c(D,{icon:t(X),text:t(o)("workflow.text.join_in_workflow"),tip:t(o)("workflow.text.join_selected_collectable_submissions_in_workflow"),onClick:f},null,8,["icon","text","tip"])])]),_:1}),c(b,{name:"free"},{tab:_(()=>[e("div",null,[a[16]||(a[16]=e("i",{class:"xiv ilv"},null,-1)),m(" "+u(t(o)("cs_helper.mode.free")),1)])]),default:_(()=>[e("div",null,[c(r,{value:n.value.free.job,"onUpdate:value":a[4]||(a[4]=s=>n.value.free.job=s),type:"line",animated:"",style:{"--n-tab-gap":"24px"}},{default:_(()=>[(p(!0),S(E,null,O(t(w).freeItemGroups,s=>(p(),I(b,{key:"cshelper-group-job-"+s.job.job_id,name:s.job.job_id,disabled:!s.totalCount},{tab:_(()=>[e("div",Ve,[c(W,{size:14,src:s.job.job_icon_url},null,8,["src"]),e("div",null,u(s.job[`job_name_${t($)}`]),1)])]),default:_(()=>[e("div",Be,[c(g,{size:"small"},{header:_(()=>[e("div",Fe,[e("span",Xe,u(t(o)("cs_helper.group.lv91_100")),1)])]),default:_(()=>[e("div",Ae,[(p(!0),S(E,null,O(s.group1Items,(d,i)=>(p(),I(F,{class:"item",key:`item-${i}`,"item-info":t(k)(d),value:n.value.free.itemSelected[d],"onUpdate:value":x=>n.value.free.itemSelected[d]=x},null,8,["item-info","value","onUpdate:value"]))),128))])]),_:2},1024),c(g,{size:"small"},{header:_(()=>[e("div",Te,[e("span",Qe,u(t(o)("cs_helper.group.lv81_90")),1)])]),default:_(()=>[e("div",Ye,[(p(!0),S(E,null,O(s.group2Items,(d,i)=>(p(),I(F,{class:"item",key:`item-${i}`,"item-info":t(k)(d),value:n.value.free.itemSelected[d],"onUpdate:value":x=>n.value.free.itemSelected[d]=x},null,8,["item-info","value","onUpdate:value"]))),128))])]),_:2},1024)]),e("div",Ze,[c(D,{icon:t(X),text:t(o)("workflow.text.join_in_workflow"),tip:t(o)("workflow.text.join_selected_collectable_submissions_in_workflow"),onClick:f},null,8,["icon","text","tip"]),c(D,{icon:t(me),text:t(o)("common.clear"),tip:t(o)("cs_helper.tooltip.clear_selected"),onClick:J},null,8,["icon","text","tip"])])]),_:2},1032,["name","disabled"]))),128))]),_:1},8,["value"])])]),_:1})]),_:1},8,["value"])]),_:1})])])}}}),Ke=T(He,[["__scopeId","data-v-a85a4ff5"]]),et={id:"main-container"},tt={id:"left-layout"},st={id:"right-layout"},at=A({__name:"CollectableSubmissionsPage",setup(U){const q=j("t"),o=j("userConfig"),M=j("appMode")??P(""),$=ie(),G=ne(),{calItems:n}=ce(),l=P(B());if(!(o.value.disable_workstate_cache??!1)){const r=o.value.cshelper_cache_work_state;r&&JSON.stringify(r).length>2&&(l.value=B(r)),Y(l,async()=>{if(l.value&&o)try{await Promise.resolve(),o.value.cshelper_cache_work_state=l.value,$.setUserConfig(o.value)}catch(s){console.error("Error handling workState change:",s)}else console.warn("workState or userConfig is not defined")},{deep:!0})}(()=>{Object.keys(C).forEach(r=>{l.value.free.itemSelected[Number(r)]??=0})})();const f=y(()=>{let r=0,s=0;l.value.target.greater.item&&(r=C[l.value.target.greater.item].rewards[2][1]),l.value.target.lesser.item&&(s=C[l.value.target.lesser.item].rewards[2][1]);let d=0,i=0;return l.value.target.greater.scrip&&(r?d=Math.ceil(l.value.target.greater.scrip/r):d="???"),l.value.target.lesser.scrip&&(s?i=Math.ceil(l.value.target.lesser.scrip/s):i="???"),{requireGreater:d,requireLesser:i}}),h=y(()=>{if(l.value.mode==="target"){const r={};return l.value.target.greater.item&&f.value.requireGreater&&f.value.requireGreater!=="???"&&(r[l.value.target.greater.item]=f.value.requireGreater),l.value.target.lesser.item&&f.value.requireLesser&&f.value.requireLesser!=="???"&&(r[l.value.target.lesser.item]=f.value.requireLesser),r}else return l.value.mode==="free"?l.value.free.itemSelected:(console.warn("unset mode!"),{})}),a=y(()=>n(h.value)),v=P(!1),g=y(()=>{const r={};return Object.values(a.value.ls).forEach(s=>{r[s.id]=s.need}),r}),b=()=>{if(!Object.values(g.value).length){G.error(q("workflow.join_in_workflow.message.no_colleactable_submission"));return}v.value=!0};return(r,s)=>{const d=de;return p(),S("div",et,[Z(c(K,{id:"router-card","page-name":t(q)("common.appfunc.cshelper"),"page-icon":t(pe)},null,8,["page-name","page-icon"]),[[H,t(M)!=="overlay"]]),e("div",tt,[c(Ke,{"work-state":t(l),"onUpdate:workState":s[0]||(s[0]=i=>z(l)?l.value=i:null),"target-data":t(f),onJoinWorkflow:b},null,8,["work-state","target-data"])]),e("div",st,[c(_e,{"hide-precraft-materials":t(l).hidePrecraftMaterials,"onUpdate:hidePrecraftMaterials":s[1]||(s[1]=i=>t(l).hidePrecraftMaterials=i),statistics:t(a),"item-selected":t(h)},null,8,["hide-precraft-materials","statistics","item-selected"])]),c(ue,{show:t(v),"onUpdate:show":s[2]||(s[2]=i=>z(v)?v.value=i:null),items:t(g)},null,8,["show","items"]),c(d)])}}}),ut=T(at,[["__scopeId","data-v-1c80a58f"]]);export{ut as default};
