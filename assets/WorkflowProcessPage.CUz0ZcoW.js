import{f as N,u as U,aT as I,aU as F,g as R,r as G,a$ as O,i as j,b1 as A,e as J}from"./index.Bh4IZ4cI.js";import{d as M,r as k,e as n,k as p,w,c as Q,S as h,Q as m,o as V}from"./vendor.Bn-7_sVg.js";import"./icons.BPYJy1hK.js";const $={id:"main-container",class:"wrapper"},q=M({__name:"WorkflowProcessPage",setup(z){const v=p("t"),r=p("userConfig"),i=p("funcConfig"),C=N(),{emitSync:D,onSync:x}=F(),{calItems:S}=U(),{getStatementData:b,getProStatementData:B,calRecommProcessData:P,calRecommProcessGroups:y}=G(r,i,v),l=k(I()),a=n(()=>l.value.workflows[l.value.currentWorkflow]),d=k(!1);if(!(r.value.disable_workstate_cache??!1)){const t=r.value.workflow_cache_work_state;t&&JSON.stringify(t).length>2&&(l.value=I(t)),w(l,async()=>{if(l.value&&r)try{if(await Promise.resolve(),d.value){d.value=!1;return}r.value.workflow_cache_work_state=l.value,C.setUserConfig(r.value),D("workflowStateChanged",A(r.value))}catch(s){console.error("Error handling workState change:",s)}else console.warn("workState or userConfig is not defined")},{deep:!0})}x("workflowStateChanged",t=>{d.value=!0,l.value=t.workflow_cache_work_state});const L=n(()=>{const t=[];for(const s in a.value.targetItems){const c=Number(s),e=a.value.targetItems[c];if(e>0){const o=R(c);o.amount=e,t.push(o)}}return t}),E=n(()=>S(a.value.targetItems)),T=n(()=>b(E.value)),f=n(()=>B(L.value,a.value.preparedItems)),W=n(()=>P(f.value.targetItemsForCal,f.value.lv1ItemsForCal,f.value.baseItemsForCal)),u=n(()=>{const{craftTargets:t,lv1Items:s,lv2Items:c,lv3Items:e,lvBaseItems:o}=W.value;return y(t,s,c,e,o,i.value.processes_craftable_item_sortby,i.value.processes_merge_gatherings,r.value.language_ui,v)}),_=()=>{const{craftTargets:t,materialsLv1:s,materialsLvBase:c}=T.value;t.forEach(e=>{const o=a.value.preparedItems.craftTarget[e.id];o?o>e.amount&&(a.value.preparedItems.craftTarget[e.id]=e.amount):a.value.preparedItems.craftTarget[e.id]=0}),s.forEach(e=>{const o=a.value.preparedItems.materialsLv1[e.id];o?o>e.amount&&(a.value.preparedItems.materialsLv1[e.id]=e.amount):a.value.preparedItems.materialsLv1[e.id]=0}),c.forEach(e=>{const o=a.value.preparedItems.materialsLvBase[e.id];o?o>e.amount&&(a.value.preparedItems.materialsLvBase[e.id]=e.amount):a.value.preparedItems.materialsLvBase[e.id]=0})},g=()=>{for(let t=0;t<u.value.length;t++)a.value.recommData.expandedBlocks[t]||(a.value.recommData.expandedBlocks[t]=["1"]),a.value.recommData.completedItems[t]||(a.value.recommData.completedItems[t]={}),u.value[t].items.forEach(s=>{a.value.recommData.completedItems[t][s.id]||(a.value.recommData.completedItems[t][s.id]=!1)})};return w(u,async()=>{g(),_()}),g(),_(),(t,s)=>{const c=j;return V(),Q("div",$,[h(O,{"expanded-blocks":m(a).recommData.expandedBlocks,"onUpdate:expandedBlocks":s[0]||(s[0]=e=>m(a).recommData.expandedBlocks=e),"completed-items":m(a).recommData.completedItems,"onUpdate:completedItems":s[1]||(s[1]=e=>m(a).recommData.completedItems=e),"item-groups":m(u),"content-max-height":"auto","content-max-width":"auto","hide-chs-offline-items":m(a).recommData.hideChsOfflineItems},null,8,["expanded-blocks","completed-items","item-groups","hide-chs-offline-items"]),h(c)])}}}),Z=J(q,[["__scopeId","data-v-a5e5f590"]]);export{Z as default};
