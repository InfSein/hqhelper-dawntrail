import{aA as se,as as ne,bI as te,d as he,at as le,e as re,f as ye,h as ke,c6 as Ce,aP as xe,au as Ue,aW as Ie,c7 as Se,b1 as ze}from"./index.Cask5RuP.js";import{aS as ie,z as ce,a as Ae,E as Fe,P as Le,aT as Ne,aU as $e,aV as X,aW as ee,aX as ae,aY as Me,aZ as oe,a_ as Ve}from"./icons.BPYJy1hK.js";import{d as ue,k as D,X as Z,r as x,e as $,P as G,o as k,Q as e,R as l,a as t,c as M,Y as Oe,S as s,F as Be,n as v,U as c,W as Te,j,V as Ee,N as Y,Z as Pe}from"./vendor.Bn-7_sVg.js";const je={class:"wrapper",ref:"wrapper"},De={class:"modal-submit-container"},Re=ue({__name:"ModalNbbAvatarSelector",props:{show:{type:Boolean,required:!0},showModifiers:{},avatarId:{required:!0},avatarIdModifiers:{}},emits:["update:show","update:avatarId"],setup(A){const a=D("t"),g=Z(A,"show"),F=Z(A,"avatarId"),b=x(0),u=$(()=>{const I=[64350,64351,64460,64463,64465],S=[];return S.push(...Array.from({length:142},(w,h)=>h+64326).filter(w=>!I.includes(w))),S}),R=()=>{b.value=F.value||64384},q=U=>{b.value===U?V():b.value=U},V=()=>{F.value=b.value,g.value=!1};return(U,L)=>{const I=ne,S=le;return k(),G(se,{show:g.value,"onUpdate:show":L[0]||(L[0]=w=>g.value=w),icon:e(ie),title:e(a)("cloud.text.select_avatar"),"max-width":"500px",onOnLoad:R},{action:l(()=>[t("div",De,[s(I,{type:"primary",size:"large",onClick:V},{icon:l(()=>[s(S,null,{default:l(()=>[s(e(ce))]),_:1})]),default:l(()=>[v(" "+c(e(a)("common.confirm")),1)]),_:1})])]),default:l(()=>[t("div",je,[(k(!0),M(Be,null,Oe(e(u),w=>(k(),G(I,{key:`avatar-${w}`,type:e(b)===w?"primary":"default",class:"avatar-button",title:w,onClick:h=>q(w)},{default:l(()=>[s(he,{src:e(te)(w),size:36},null,8,["src"])]),_:2},1032,["type","title","onClick"]))),128))],512)]),_:1},8,["show","icon","title"])}}}),qe=re(Re,[["__scopeId","data-v-9367248d"]]),We={class:"wrapper"},Xe={key:0,class:"login-panel"},Ye={class:"form-container"},Ze={class:"form-label"},Ge={class:"form-label"},Ke={class:"sub-links"},Qe={key:1,class:"register-panel"},He={class:"form-container"},Je={class:"form-label"},ea={class:"form-label"},aa={class:"form-label"},oa={class:"form-label"},sa={class:"form-label"},na={class:"sub-links"},ta={key:2,class:"resetpass-panel"},la={class:"form-container"},ra={class:"form-label"},ia={class:"form-label"},ca={class:"form-label"},ua={class:"sub-links"},da={key:3,class:"edituser-panel"},ma={class:"form-container"},_a={class:"form-label"},va={class:"form-label"},pa={class:"form-label"},fa={class:"avatar-edit-container"},ga={class:"modal-submit-container"},wa=ue({__name:"ModalLogin",props:Te({defaultTab:{}},{show:{type:Boolean,required:!0},showModifiers:{}}),emits:["update:show"],setup(A){const a=D("t"),g=D("cloudConfig"),F=D("appForceUpdate")??(()=>{}),b=ye(),u=ke(),{sendVerify:R,sendVerifyForResetPassword:q,register:V,login:U,resetPassword:L,resolveUserInfo:I,resetNickNameAndTitle:S,resetAvatar:w}=Ce(g),h=Z(A,"show"),de=A,_=x("login"),O=x(0),N=x(!1),z=x(!1),B=x(!1),T=x(!1),y=j({account:"",password:""}),d=j({email:"",nickname:"",loginname:"",password:"",verifycode:""}),f=j({email:"",password:"",verifycode:""}),m=j({nickname:"",title:"",avatar:0}),me=()=>{_.value=de.defaultTab,m.nickname=g.value.nbb_account_nickname,m.title=g.value.nbb_account_title,m.avatar=g.value.nbb_account_avatar},_e=$(()=>{switch(_.value){case"resetpass":return Ne;case"register":return Le;case"edituser":return Fe;case"login":default:return Ae}}),ve=$(()=>{switch(_.value){case"resetpass":return a("cloud.text.reset_password");case"register":return a("common.register");case"edituser":return a("cloud.text.edit_account_info");case"login":default:return a("common.login")}}),K=$(()=>N.value?a("cloud.message.verify_cooldown",O.value):a("cloud.text.send_verify")),pe=$(()=>{const r=m.avatar||64384;return te(r)}),fe=r=>{O.value=r,N.value=!0;const o=setInterval(()=>{O.value--,O.value<=0&&(clearInterval(o),N.value=!1)},1e3)},W=(r,o,i)=>r.replace(/[\u4e00-\u9fa5]/g,"aa").length>o?a("cloud.message.key_is_too_long",{key:i}):"",E=(r,o="",i="",p=!0)=>{if(r.errno){let C="";i&&(C+=i),p&&(C+=r.errmsg),u.error(C)}else{const C=o||a("cloud.message.operate_succeed");u.success(C)}},Q=r=>{const o=I(r,g.value);b.setCloudConfig(o),F()},H=async r=>{if(r){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)){u.error(a("cloud.message.email_format_wrong"));return}}else{u.error(a("common.message.please_input_val",a("common.email")));return}z.value=!0;const o=_.value==="resetpass"?q:R;try{const i=await o(r);E(i,a("cloud.message.verify_sent")),i.errno||fe(60)}catch(i){u.error(a("cloud.message.verify_send_failed",i.message)),console.error(`Send verify failed:
`,i)}finally{z.value=!1}},ge=()=>{T.value=!0},we=async()=>{try{if(B.value=!0,_.value==="login"){if(y.account){if(!y.password){u.error(a("common.message.please_input_val",a("common.password")));return}}else{u.error(a("common.message.please_input_val",a("common.account")));return}const r=await U(y.account,y.password);E(r,a("cloud.message.login_succeed")),r.errno||(Q(r.data),h.value=!1)}else if(_.value==="register"){if(d.email)if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email))if(d.verifycode)if(d.loginname)if(d.nickname){if(!d.password){u.error(a("common.message.please_input_val",a("common.password")));return}}else{u.error(a("common.message.please_input_val",a("common.nickname")));return}else{u.error(a("common.message.please_input_val",a("common.login_name")));return}else{u.error(a("common.message.please_input_val",a("common.verify_code")));return}else{u.error(a("cloud.message.email_format_wrong"));return}else{u.error(a("common.message.please_input_val",a("common.email")));return}const r=W(d.nickname,12,a("common.nickname"));if(r){u.error(r);return}const o=await V(d.email,d.nickname,d.loginname,d.password,d.verifycode);E(o,a("cloud.message.register_succeed")),o.errno||(Q(o.data),h.value=!1)}else if(_.value==="resetpass"){if(f.email)if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email))if(f.verifycode){if(!f.password){u.error(a("common.message.please_input_val",a("common.password")));return}}else{u.error(a("common.message.please_input_val",a("common.verify_code")));return}else{u.error(a("cloud.message.email_format_wrong"));return}else{u.error(a("common.message.please_input_val",a("common.email")));return}const r=await L(f.email,f.password,f.verifycode);E(r,a("cloud.message.reset_password_succeed")),r.errno||(_.value="login")}else if(_.value==="edituser"){if(!m.nickname){u.error(a("common.message.please_input_val",a("common.nickname")));return}const r=W(m.nickname,12,a("common.nickname"))||W(m.title,20,a("cloud.text.user_title"));if(r){u.error(r);return}const o=ze(g.value);if(m.nickname!==g.value.nbb_account_nickname||m.title!==g.value.nbb_account_title){const i=await S(m.nickname,m.title);if(i.errno){u.error(a("cloud.message.reset_nick_or_title_failed",i.errmsg));return}else o.nbb_account_nickname=m.nickname,o.nbb_account_title=m.title,b.setCloudConfig(o)}if(m.avatar!==g.value.nbb_account_avatar){const i=await w(m.avatar);if(i.errno){u.error(a("cloud.message.reset_avatar_failed",i.errmsg));return}else o.nbb_account_avatar=m.avatar,b.setCloudConfig(o)}F(),h.value=!1}else console.error("Unexpected loginAction",_.value)}catch(r){u.error(a("cloud.message.submit_failed",r.message)),console.error(`Submit failed:
`,r)}finally{B.value=!1}};return(r,o)=>{const i=le,p=xe,C=Ue,P=ne,J=Ie,be=Se;return k(),G(se,{show:h.value,"onUpdate:show":o[20]||(o[20]=n=>h.value=n),"max-width":"500px",icon:e(_e),title:e(ve),onOnLoad:me},{action:l(()=>[t("div",ga,[s(P,{type:"primary",size:"large",loading:e(B),disabled:e(B),onClick:we},{icon:l(()=>[s(i,null,{default:l(()=>[s(e(ce))]),_:1})]),default:l(()=>[v(" "+c(e(a)("common.confirm")),1)]),_:1},8,["loading","disabled"])])]),default:l(()=>[t("div",We,[e(_)==="login"?(k(),M("div",Xe,[t("div",Ye,[t("div",Ze,[s(i,{size:15},{default:l(()=>[s(e($e))]),_:1}),v(" "+c(e(a)("common.account")),1)]),s(p,{value:e(y).account,"onUpdate:value":o[0]||(o[0]=n=>e(y).account=n),placeholder:e(a)("cloud.message.please_input_loginname_or_email")},null,8,["value","placeholder"]),t("div",Ge,[s(i,{size:15},{default:l(()=>[s(e(X))]),_:1}),v(" "+c(e(a)("common.password")),1)]),s(p,{type:"password",value:e(y).password,"onUpdate:value":o[1]||(o[1]=n=>e(y).password=n),"show-password-on":"click",placeholder:e(a)("common.message.please_input_val",e(a)("common.password"))},null,8,["value","placeholder"])]),t("div",Ke,[t("a",{href:"javascript:void(0);",onClick:o[2]||(o[2]=n=>_.value="register")},c(e(a)("cloud.text.register_account")),1),s(C,{vertical:""}),t("a",{href:"javascript:void(0);",onClick:o[3]||(o[3]=n=>_.value="resetpass")},c(e(a)("cloud.text.forgot_password")),1)])])):e(_)==="register"?(k(),M("div",Qe,[t("div",He,[t("div",Je,[s(i,{size:15},{default:l(()=>[s(e(ee))]),_:1}),v(" "+c(e(a)("common.email")),1)]),s(p,{value:e(d).email,"onUpdate:value":o[4]||(o[4]=n=>e(d).email=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.email"))},null,8,["value","placeholder"]),t("div",ea,[s(i,{size:15},{default:l(()=>[s(e(ae))]),_:1}),v(" "+c(e(a)("common.verify_code")),1)]),s(J,null,{default:l(()=>[s(p,{value:e(d).verifycode,"onUpdate:value":o[5]||(o[5]=n=>e(d).verifycode=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.verify_code"))},null,8,["value","placeholder"]),s(P,{type:"info",disabled:e(N)||e(z),loading:e(z),onClick:o[6]||(o[6]=n=>H(e(d).email))},{default:l(()=>[v(c(e(K)),1)]),_:1},8,["disabled","loading"])]),_:1}),t("div",aa,[s(i,{size:15},{default:l(()=>[s(e(Me))]),_:1}),v(" "+c(e(a)("common.login_name")),1)]),s(p,{value:e(d).loginname,"onUpdate:value":o[7]||(o[7]=n=>e(d).loginname=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.login_name"))},null,8,["value","placeholder"]),t("div",oa,[s(i,{size:15},{default:l(()=>[s(e(oe))]),_:1}),v(" "+c(e(a)("common.nickname")),1)]),s(p,{value:e(d).nickname,"onUpdate:value":o[8]||(o[8]=n=>e(d).nickname=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.nickname")),"show-count":"",clearable:""},{count:l(({value:n})=>[t("span",{style:Y(n.replace(/[\u4e00-\u9fa5]/g,"aa").length>12?"color: var(--color-error);":"")},c(n.replace(/[\u4e00-\u9fa5]/g,"aa").length+" / 12"),5)]),_:1},8,["value","placeholder"]),t("div",sa,[s(i,{size:15},{default:l(()=>[s(e(X))]),_:1}),v(" "+c(e(a)("common.password")),1)]),s(p,{value:e(d).password,"onUpdate:value":o[9]||(o[9]=n=>e(d).password=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.password"))},null,8,["value","placeholder"])]),t("div",na,[t("div",null,c(e(a)("cloud.text.do_you_have_an_account")),1),t("a",{href:"javascript:void(0);",onClick:o[10]||(o[10]=n=>_.value="login")},c(e(a)("cloud.text.click_here_to_login")),1)])])):e(_)==="resetpass"?(k(),M("div",ta,[t("div",la,[t("div",ra,[s(i,{size:15},{default:l(()=>[s(e(ee))]),_:1}),v(" "+c(e(a)("common.email")),1)]),s(p,{value:e(f).email,"onUpdate:value":o[11]||(o[11]=n=>e(f).email=n),placeholder:e(a)("cloud.text.please_input_email_when_registered")},null,8,["value","placeholder"]),t("div",ia,[s(i,{size:15},{default:l(()=>[s(e(ae))]),_:1}),v(" "+c(e(a)("common.verify_code")),1)]),s(J,null,{default:l(()=>[s(p,{value:e(f).verifycode,"onUpdate:value":o[12]||(o[12]=n=>e(f).verifycode=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.verify_code"))},null,8,["value","placeholder"]),s(P,{type:"info",disabled:e(N)||e(z),loading:e(z),onClick:o[13]||(o[13]=n=>H(e(f).email))},{default:l(()=>[v(c(e(K)),1)]),_:1},8,["disabled","loading"])]),_:1}),t("div",ca,[s(i,{size:15},{default:l(()=>[s(e(X))]),_:1}),v(" "+c(e(a)("cloud.text.new_password")),1)]),s(p,{value:e(f).password,"onUpdate:value":o[14]||(o[14]=n=>e(f).password=n),placeholder:e(a)("cloud.text.please_input_new_password")},null,8,["value","placeholder"])]),t("div",ua,[t("a",{href:"javascript:void(0);",onClick:o[15]||(o[15]=n=>_.value="login")},c(e(a)("cloud.text.back_to_login")),1)])])):e(_)==="edituser"?(k(),M("div",da,[t("div",ma,[t("div",_a,[s(i,{size:15},{default:l(()=>[s(e(oe))]),_:1}),v(" "+c(e(a)("common.nickname")),1)]),s(p,{value:e(m).nickname,"onUpdate:value":o[16]||(o[16]=n=>e(m).nickname=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.nickname")),"show-count":"",clearable:""},{count:l(({value:n})=>[t("span",{style:Y(n.replace(/[\u4e00-\u9fa5]/g,"aa").length>12?"color: var(--color-error);":"")},c(n.replace(/[\u4e00-\u9fa5]/g,"aa").length+" / 12"),5)]),_:1},8,["value","placeholder"]),t("div",va,[s(i,{size:15},{default:l(()=>[s(e(Ve))]),_:1}),v(" "+c(e(a)("cloud.text.user_title")),1)]),s(p,{value:e(m).title,"onUpdate:value":o[17]||(o[17]=n=>e(m).title=n),placeholder:e(a)("common.message.please_input_val",e(a)("cloud.text.user_title")),"show-count":"",clearable:""},{count:l(({value:n})=>[t("span",{style:Y(n.replace(/[\u4e00-\u9fa5]/g,"aa").length>20?"color: var(--color-error);":"")},c(n.replace(/[\u4e00-\u9fa5]/g,"aa").length+" / 20"),5)]),_:1},8,["value","placeholder"]),t("div",pa,[s(i,{size:15},{default:l(()=>[s(e(ie))]),_:1}),v(" "+c(e(a)("cloud.text.avatar")),1)]),t("div",fa,[s(be,{size:48,src:e(pe),class:"button-avatar"},null,8,["src"]),s(P,{size:"small",onClick:ge},{default:l(()=>[v(c(e(a)("common.edit")),1)]),_:1})])])])):Ee("",!0)]),s(qe,{show:e(T),"onUpdate:show":o[18]||(o[18]=n=>Pe(T)?T.value=n:null),"avatar-id":e(m).avatar,"onUpdate:avatarId":o[19]||(o[19]=n=>e(m).avatar=n)},null,8,["show","avatar-id"])]),_:1},8,["show","icon","title"])}}}),ka=re(wa,[["__scopeId","data-v-f4d737f1"]]);export{ka as default};
