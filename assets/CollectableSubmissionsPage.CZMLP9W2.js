import{d as Q,W as V,X as Z,e as y,c as x,a as t,U as u,R as _,o as p,L as G,Q as e,k as I,n as m,V as d,P as C,F as P,Y as W,r as J,w as H,q as K,y as ee,Z as R}from"./vendor.DOOPojup.js";import{R as te}from"./RouterCard.Cx2UkE-r.js";import{k as se,X as U,E,g as S,l as ae,_ as re,a as le,d as oe,b as ie,m as ne,n as B,I as X,c as z,e as D,f as Y,h as ce,i as ue,u as de,o as A,M as _e,j as me}from"./index.DIpgTaJR.js";import{I as F,S as pe}from"./StatisticsPanel.O_-ZiVjP.js";import{J as T,p as ve,ae as fe}from"./icons._F9tMcs6.js";import"./CraftStatistics.CxK9Etq4.js";const ge={class:"panel-wrapper"},we={class:"card-title-text"},he={class:"item-selection-container"},be={class:"card-title"},ke={class:"title"},Se={class:"target-card-container"},xe={class:"item"},je={class:"item"},Ie={class:"item"},Ce={class:"submission-reward-container"},ye={key:1},Ue={class:"item require-amount-container"},qe={class:"title"},Le={class:"amount"},Me={class:"require-amount"},Ge={class:"card-title"},Ee={class:"title"},$e={class:"target-card-container"},Oe={class:"item"},Pe={class:"item"},We={class:"item"},Je={class:"submission-reward-container"},ze={key:1},De={class:"item require-amount-container"},Ne={class:"title"},Ve={class:"amount"},Re={class:"require-amount"},Be={class:"actions"},Xe={class:"flex-vac gap-2"},Ae={class:"item-selection-container"},Fe={class:"card-title"},Te={class:"title"},Qe={class:"item-btn-container"},Ye={class:"card-title"},Ze={class:"title"},He={class:"item-btn-container"},Ke={class:"actions"},et=Q({__name:"ItemSelectionPanel",props:V({targetData:{}},{workState:{required:!0},workStateModifiers:{}}),emits:V(["joinWorkflow"],["update:workState"]),setup(q,{emit:L}){const o=I("t"),k=I("userConfig");I("funcConfig");const{uiLanguage:$,itemLanguage:M}=se(k),c=Z(q,"workState"),i=L,w=y(()=>{const h=[],s=[],v={};Object.values(U).forEach(a=>{a.rewardScrip===E.crafterScripGreater?h.push(a.id):a.rewardScrip===E.crafterScripLesser?s.push(a.id):console.warn("unknown item",a);const n=S(a.id);v[n.craftInfo.jobId]??=[],v[n.craftInfo.jobId].push(a.id)});const g=Object.entries(v).map(([a,n])=>{const r=n.map(l=>U[l]);return{job:ae[Number(a)],group1Items:r.filter(l=>b(l.levels,91,100)).map(l=>l.id),group2Items:r.filter(l=>b(l.levels,81,90)).map(l=>l.id),totalCount:r.length}});return g.sort((a,n)=>a.job.job_id-n.job.job_id),{greaterOptions:h,lesserOptions:s,scripGreater:S(E.crafterScripGreater),scripLesser:S(E.crafterScripLesser),freeItemGroups:g};function b(a,n,r){let l=!0;return a.forEach(j=>{j>=n&&j<=r||(l=!1)}),l}}),N=()=>{for(const h in c.value.free.itemSelected)c.value.free.itemSelected[h]=0},f=()=>{i("joinWorkflow")};return(h,s)=>{const v=ne,g=ie,b=oe,a=le,n=re;return p(),x("div",ge,[t("div",null,[u(n,{"card-key":"ft-item-selection"},{header:_(()=>[s[6]||(s[6]=t("i",{class:"xiv square-1"},null,-1)),t("span",we,d(e(o)("cs_helper.select_collectable_submission")),1)]),default:_(()=>[u(a,{value:c.value.mode,"onUpdate:value":s[5]||(s[5]=r=>c.value.mode=r),type:"segment",animated:""},{default:_(()=>[u(b,{name:"target"},{tab:_(()=>[t("div",null,[s[7]||(s[7]=t("i",{class:"xiv e05e"},null,-1)),m(" "+d(e(o)("cs_helper.mode.target")),1)])]),default:_(()=>[t("div",he,[u(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",be,[u(z,{size:16,src:e(w).scripGreater.iconUrl},null,8,["src"]),t("span",ke,d(e(w).scripGreater[`name_${e(M)}`]),1)])]),default:_(()=>[t("div",Se,[t("div",xe,[s[8]||(s[8]=t("i",{class:"xiv e05e"},null,-1)),m(" "+d(e(o)("cs_helper.action.target_scrip_amount"))+" ",1),u(v,{value:c.value.target.greater.scrip,"onUpdate:value":s[0]||(s[0]=r=>c.value.target.greater.scrip=r),min:0,max:9999999},null,8,["value"])]),t("div",je,[s[9]||(s[9]=t("i",{class:"xiv collectables"},null,-1)),m(" "+d(e(o)("cs_helper.action.craft_target"))+" ",1),u(B,{"model-value":c.value.target.greater.item,"onUpdate:modelValue":s[1]||(s[1]=r=>c.value.target.greater.item=r),"dont-clean-after-select":"","options-preset":"custom",options:e(w).greaterOptions},null,8,["model-value","options"])]),t("div",Ie,[s[10]||(s[10]=t("i",{class:"xiv crystal"},null,-1)),m(" "+d(e(o)("cs_helper.action.reward"))+" ",1),t("div",Ce,[c.value.target.greater.item?(p(),C(X,{key:0,"item-info":e(S)(c.value.target.greater.item)},null,8,["item-info"])):(p(),x("div",ye,d(e(o)("cs_helper.message.select_craft_target_first")),1))])]),t("div",Ue,[t("div",qe,[s[11]||(s[11]=t("i",{class:"xiv arrow-right"},null,-1)),m(" "+d(e(o)("cs_helper.action.need_craft")),1)]),t("div",Le,[t("span",Me,d(q.targetData.requireGreater),1),m(" "+d(e(o)("common.unit.ge")),1)])])])]),_:1},8,["class"]),u(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",Ge,[u(z,{size:16,src:e(w).scripLesser.iconUrl},null,8,["src"]),t("span",Ee,d(e(w).scripLesser[`name_${e(M)}`]),1)])]),default:_(()=>[t("div",$e,[t("div",Oe,[s[12]||(s[12]=t("i",{class:"xiv e05e"},null,-1)),m(" "+d(e(o)("cs_helper.action.target_scrip_amount"))+" ",1),u(v,{value:c.value.target.lesser.scrip,"onUpdate:value":s[2]||(s[2]=r=>c.value.target.lesser.scrip=r),min:0,max:9999999},null,8,["value"])]),t("div",Pe,[s[13]||(s[13]=t("i",{class:"xiv collectables"},null,-1)),m(" "+d(e(o)("cs_helper.action.craft_target"))+" ",1),u(B,{"model-value":c.value.target.lesser.item,"onUpdate:modelValue":s[3]||(s[3]=r=>c.value.target.lesser.item=r),"dont-clean-after-select":"","options-preset":"custom",options:e(w).lesserOptions},null,8,["model-value","options"])]),t("div",We,[s[14]||(s[14]=t("i",{class:"xiv crystal"},null,-1)),m(" "+d(e(o)("cs_helper.action.reward"))+" ",1),t("div",Je,[c.value.target.lesser.item?(p(),C(X,{key:0,"item-info":e(S)(c.value.target.lesser.item)},null,8,["item-info"])):(p(),x("div",ze,d(e(o)("cs_helper.message.select_craft_target_first")),1))])]),t("div",De,[t("div",Ne,[s[15]||(s[15]=t("i",{class:"xiv arrow-right"},null,-1)),m(" "+d(e(o)("cs_helper.action.need_craft")),1)]),t("div",Ve,[t("span",Re,d(q.targetData.requireLesser),1),m(" "+d(e(o)("common.unit.ge")),1)])])])]),_:1},8,["class"])]),t("div",Be,[u(D,{icon:e(T),text:e(o)("workflow.text.join_in_workflow"),tip:e(o)("workflow.text.join_selected_collectable_submissions_in_workflow"),onClick:f},null,8,["icon","text","tip"])])]),_:1}),u(b,{name:"free"},{tab:_(()=>[t("div",null,[s[16]||(s[16]=t("i",{class:"xiv ilv"},null,-1)),m(" "+d(e(o)("cs_helper.mode.free")),1)])]),default:_(()=>[t("div",null,[u(a,{value:c.value.free.job,"onUpdate:value":s[4]||(s[4]=r=>c.value.free.job=r),type:"line",animated:"",style:{"--n-tab-gap":"24px"}},{default:_(()=>[(p(!0),x(P,null,W(e(w).freeItemGroups,r=>(p(),C(b,{key:"cshelper-group-job-"+r.job.job_id,name:r.job.job_id,disabled:!r.totalCount},{tab:_(()=>[t("div",Xe,[u(z,{size:14,src:r.job.job_icon_url},null,8,["src"]),t("div",null,d(r.job[`job_name_${e($)}`]),1)])]),default:_(()=>[t("div",Ae,[u(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",Fe,[t("span",Te,d(e(o)("cs_helper.group.lv91_100")),1)])]),default:_(()=>[t("div",Qe,[(p(!0),x(P,null,W(r.group1Items,(l,j)=>(p(),C(F,{class:"item",key:`item-${j}`,"item-info":e(S)(l),value:c.value.free.itemSelected[l],"onUpdate:value":O=>c.value.free.itemSelected[l]=O},null,8,["item-info","value","onUpdate:value"]))),128))])]),_:2},1032,["class"]),u(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",Ye,[t("span",Ze,d(e(o)("cs_helper.group.lv81_90")),1)])]),default:_(()=>[t("div",He,[(p(!0),x(P,null,W(r.group2Items,(l,j)=>(p(),C(F,{class:"item",key:`item-${j}`,"item-info":e(S)(l),value:c.value.free.itemSelected[l],"onUpdate:value":O=>c.value.free.itemSelected[l]=O},null,8,["item-info","value","onUpdate:value"]))),128))])]),_:2},1032,["class"])]),t("div",Ke,[u(D,{icon:e(T),text:e(o)("workflow.text.join_in_workflow"),tip:e(o)("workflow.text.join_selected_collectable_submissions_in_workflow"),onClick:f},null,8,["icon","text","tip"]),u(D,{icon:e(ve),text:e(o)("common.clear"),tip:e(o)("cs_helper.tooltip.clear_selected"),onClick:N},null,8,["icon","text","tip"])])]),_:2},1032,["name","disabled"]))),128))]),_:1},8,["value"])])]),_:1})]),_:1},8,["value"])]),_:1})])])}}}),tt=Y(et,[["__scopeId","data-v-12982cfa"]]),st={id:"main-container"},at={id:"left-layout"},rt={id:"right-layout"},lt=Q({__name:"CollectableSubmissionsPage",setup(q){const L=I("t"),o=I("userConfig"),k=I("appMode")??J(""),$=ce(),M=ue(),{calItems:c}=de(),i=J(A());if(!(o.value.disable_workstate_cache??!1)){const a=o.value.cshelper_cache_work_state;a&&JSON.stringify(a).length>2&&(i.value=A(a)),H(i,async()=>{if(i.value&&o)try{await Promise.resolve(),o.value.cshelper_cache_work_state=i.value,$.setUserConfig(o.value)}catch(n){console.error("Error handling workState change:",n)}else console.warn("workState or userConfig is not defined")},{deep:!0})}(()=>{Object.keys(U).forEach(a=>{i.value.free.itemSelected[Number(a)]??=0})})();const f=y(()=>{let a=0,n=0;i.value.target.greater.item&&(a=U[i.value.target.greater.item].rewards[2][1]),i.value.target.lesser.item&&(n=U[i.value.target.lesser.item].rewards[2][1]);let r=0,l=0;return i.value.target.greater.scrip&&(a?r=Math.ceil(i.value.target.greater.scrip/a):r="???"),i.value.target.lesser.scrip&&(n?l=Math.ceil(i.value.target.lesser.scrip/n):l="???"),{requireGreater:r,requireLesser:l}}),h=y(()=>{if(i.value.mode==="target"){const a={};return i.value.target.greater.item&&f.value.requireGreater&&f.value.requireGreater!=="???"&&(a[i.value.target.greater.item]=f.value.requireGreater),i.value.target.lesser.item&&f.value.requireLesser&&f.value.requireLesser!=="???"&&(a[i.value.target.lesser.item]=f.value.requireLesser),a}else return i.value.mode==="free"?i.value.free.itemSelected:(console.warn("unset mode!"),{})}),s=y(()=>c(h.value)),v=J(!1),g=y(()=>{const a={};return Object.values(s.value.ls).forEach(n=>{a[n.id]=n.need}),a}),b=()=>{if(!Object.values(g.value).length){M.error(L("workflow.join_in_workflow.message.no_colleactable_submission"));return}v.value=!0};return(a,n)=>{const r=me;return p(),x("div",st,[K(u(te,{id:"router-card","page-name":e(L)("common.appfunc.cshelper"),"page-icon":e(fe)},null,8,["page-name","page-icon"]),[[ee,e(k)!=="overlay"]]),t("div",at,[u(tt,{"work-state":e(i),"onUpdate:workState":n[0]||(n[0]=l=>R(i)?i.value=l:null),"target-data":e(f),onJoinWorkflow:b},null,8,["work-state","target-data"])]),t("div",rt,[u(pe,{"hide-precraft-materials":e(i).hidePrecraftMaterials,"onUpdate:hidePrecraftMaterials":n[1]||(n[1]=l=>e(i).hidePrecraftMaterials=l),statistics:e(s),"item-selected":e(h)},null,8,["hide-precraft-materials","statistics","item-selected"])]),u(_e,{show:e(v),"onUpdate:show":n[2]||(n[2]=l=>R(v)?v.value=l:null),items:e(g)},null,8,["show","items"]),u(r)])}}}),_t=Y(lt,[["__scopeId","data-v-1c80a58f"]]);export{_t as default};
