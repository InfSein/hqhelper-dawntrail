import{d as T,W as N,X as Y,e as y,c as x,a as t,U as c,R as _,o as p,L as G,Q as e,k as I,n as m,V as u,P as C,F as O,Y as P,r as W,w as Z,q as H,y as K,Z as V}from"./vendor.DaGD8wRy.js";import{R as ee}from"./RouterCard.DjppuA0M.js";import{j as te,X as U,E,g as S,k as se,F as ae,_ as re,c as le,a as oe,l as ie,m as R,I as B,b as J,d as z,e as Q,f as ne,h as ce,u as ue,n as F,M as de,i as _e}from"./index.DjNjFiam.js";import{I as X,S as me}from"./StatisticsPanel.C7QEa2Q6.js";import{J as A,p as pe,ae as ve}from"./icons.BN6_TYLH.js";import"./CraftStatistics.COXiC5Gz.js";const fe={class:"panel-wrapper"},ge={class:"card-title-text"},we={class:"item-selection-container"},be={class:"card-title"},he={class:"title"},ke={class:"target-card-container"},Se={class:"item"},xe={class:"item"},je={class:"item"},Ie={class:"submission-reward-container"},Ce={key:1},ye={class:"item require-amount-container"},Ue={class:"title"},qe={class:"amount"},Le={class:"require-amount"},Me={class:"card-title"},Ge={class:"title"},Ee={class:"target-card-container"},$e={class:"item"},Oe={class:"item"},Pe={class:"item"},We={class:"submission-reward-container"},Je={key:1},ze={class:"item require-amount-container"},De={class:"title"},Ne={class:"amount"},Ve={class:"require-amount"},Re={class:"actions"},Be={class:"flex-vac gap-2"},Fe={class:"item-selection-container"},Xe={class:"card-title"},Ae={class:"title"},Te={class:"item-btn-container"},Qe={class:"card-title"},Ye={class:"title"},Ze={class:"item-btn-container"},He={class:"actions"},Ke=T({__name:"ItemSelectionPanel",props:N({targetData:{}},{workState:{required:!0},workStateModifiers:{}}),emits:N(["joinWorkflow"],["update:workState"]),setup(q,{emit:L}){const l=I("t"),k=I("userConfig");I("funcConfig");const{uiLanguage:$,itemLanguage:M}=te(k),n=Y(q,"workState"),o=L,w=y(()=>{const b=[],a=[],v={};Object.values(U).forEach(r=>{r.rewardScrip===E.crafterScripGreater?b.push(r.id):r.rewardScrip===E.crafterScripLesser?a.push(r.id):console.warn("unknown item",r);const s=S(r.id);v[s.craftInfo.jobId]??=[],v[s.craftInfo.jobId].push(r.id)});const g=Object.entries(v).map(([r,s])=>{const d=s.map(i=>U[i]);return{job:se[Number(r)],group1Items:d.filter(i=>h(i.levels,91,100)).map(i=>i.id),group2Items:d.filter(i=>h(i.levels,81,90)).map(i=>i.id),totalCount:d.length}});return g.sort((r,s)=>r.job.job_id-s.job.job_id),{greaterOptions:b,lesserOptions:a,scripGreater:S(E.crafterScripGreater),scripLesser:S(E.crafterScripLesser),freeItemGroups:g};function h(r,s,d){let i=!0;return r.forEach(j=>{j>=s&&j<=d||(i=!1)}),i}}),D=()=>{for(const b in n.value.free.itemSelected)n.value.free.itemSelected[b]=0},f=()=>{o("joinWorkflow")};return(b,a)=>{const v=ie,g=oe,h=le,r=re;return p(),x("div",fe,[t("div",null,[c(ae,{"card-key":"ft-item-selection"},{header:_(()=>[a[6]||(a[6]=t("i",{class:"xiv square-1"},null,-1)),t("span",ge,u(e(l)("cs_helper.select_collectable_submission")),1)]),default:_(()=>[c(r,{value:n.value.mode,"onUpdate:value":a[5]||(a[5]=s=>n.value.mode=s),type:"segment",animated:""},{default:_(()=>[c(h,{name:"target"},{tab:_(()=>[t("div",null,[a[7]||(a[7]=t("i",{class:"xiv e05e"},null,-1)),m(" "+u(e(l)("cs_helper.mode.target")),1)])]),default:_(()=>[t("div",we,[c(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",be,[c(J,{size:16,src:e(w).scripGreater.iconUrl},null,8,["src"]),t("span",he,u(e(w).scripGreater[`name_${e(M)}`]),1)])]),default:_(()=>[t("div",ke,[t("div",Se,[a[8]||(a[8]=t("i",{class:"xiv e05e"},null,-1)),m(" "+u(e(l)("cs_helper.action.target_scrip_amount"))+" ",1),c(v,{value:n.value.target.greater.scrip,"onUpdate:value":a[0]||(a[0]=s=>n.value.target.greater.scrip=s),min:0,max:9999999},null,8,["value"])]),t("div",xe,[a[9]||(a[9]=t("i",{class:"xiv collectables"},null,-1)),m(" "+u(e(l)("cs_helper.action.craft_target"))+" ",1),c(R,{"model-value":n.value.target.greater.item,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.target.greater.item=s),"dont-clean-after-select":"","options-preset":"custom",options:e(w).greaterOptions},null,8,["model-value","options"])]),t("div",je,[a[10]||(a[10]=t("i",{class:"xiv crystal"},null,-1)),m(" "+u(e(l)("cs_helper.action.reward"))+" ",1),t("div",Ie,[n.value.target.greater.item?(p(),C(B,{key:0,"item-info":e(S)(n.value.target.greater.item)},null,8,["item-info"])):(p(),x("div",Ce,u(e(l)("cs_helper.message.select_craft_target_first")),1))])]),t("div",ye,[t("div",Ue,[a[11]||(a[11]=t("i",{class:"xiv arrow-right"},null,-1)),m(" "+u(e(l)("cs_helper.action.need_craft")),1)]),t("div",qe,[t("span",Le,u(q.targetData.requireGreater),1),m(" "+u(e(l)("common.unit.ge")),1)])])])]),_:1},8,["class"]),c(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",Me,[c(J,{size:16,src:e(w).scripLesser.iconUrl},null,8,["src"]),t("span",Ge,u(e(w).scripLesser[`name_${e(M)}`]),1)])]),default:_(()=>[t("div",Ee,[t("div",$e,[a[12]||(a[12]=t("i",{class:"xiv e05e"},null,-1)),m(" "+u(e(l)("cs_helper.action.target_scrip_amount"))+" ",1),c(v,{value:n.value.target.lesser.scrip,"onUpdate:value":a[2]||(a[2]=s=>n.value.target.lesser.scrip=s),min:0,max:9999999},null,8,["value"])]),t("div",Oe,[a[13]||(a[13]=t("i",{class:"xiv collectables"},null,-1)),m(" "+u(e(l)("cs_helper.action.craft_target"))+" ",1),c(R,{"model-value":n.value.target.lesser.item,"onUpdate:modelValue":a[3]||(a[3]=s=>n.value.target.lesser.item=s),"dont-clean-after-select":"","options-preset":"custom",options:e(w).lesserOptions},null,8,["model-value","options"])]),t("div",Pe,[a[14]||(a[14]=t("i",{class:"xiv crystal"},null,-1)),m(" "+u(e(l)("cs_helper.action.reward"))+" ",1),t("div",We,[n.value.target.lesser.item?(p(),C(B,{key:0,"item-info":e(S)(n.value.target.lesser.item)},null,8,["item-info"])):(p(),x("div",Je,u(e(l)("cs_helper.message.select_craft_target_first")),1))])]),t("div",ze,[t("div",De,[a[15]||(a[15]=t("i",{class:"xiv arrow-right"},null,-1)),m(" "+u(e(l)("cs_helper.action.need_craft")),1)]),t("div",Ne,[t("span",Ve,u(q.targetData.requireLesser),1),m(" "+u(e(l)("common.unit.ge")),1)])])])]),_:1},8,["class"])]),t("div",Re,[c(z,{icon:e(A),text:e(l)("workflow.text.join_in_workflow"),tip:e(l)("workflow.text.join_selected_collectable_submissions_in_workflow"),onClick:f},null,8,["icon","text","tip"])])]),_:1}),c(h,{name:"free"},{tab:_(()=>[t("div",null,[a[16]||(a[16]=t("i",{class:"xiv ilv"},null,-1)),m(" "+u(e(l)("cs_helper.mode.free")),1)])]),default:_(()=>[t("div",null,[c(r,{value:n.value.free.job,"onUpdate:value":a[4]||(a[4]=s=>n.value.free.job=s),type:"line",animated:"",style:{"--n-tab-gap":"24px"}},{default:_(()=>[(p(!0),x(O,null,P(e(w).freeItemGroups,s=>(p(),C(h,{key:"cshelper-group-job-"+s.job.job_id,name:s.job.job_id,disabled:!s.totalCount},{tab:_(()=>[t("div",Be,[c(J,{size:14,src:s.job.job_icon_url},null,8,["src"]),t("div",null,u(s.job[`job_name_${e($)}`]),1)])]),default:_(()=>[t("div",Fe,[c(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",Xe,[t("span",Ae,u(e(l)("cs_helper.group.lv91_100")),1)])]),default:_(()=>[t("div",Te,[(p(!0),x(O,null,P(s.group1Items,(d,i)=>(p(),C(X,{class:"item",key:`item-${i}`,"item-info":e(S)(d),value:n.value.free.itemSelected[d],"onUpdate:value":j=>n.value.free.itemSelected[d]=j},null,8,["item-info","value","onUpdate:value"]))),128))])]),_:2},1032,["class"]),c(g,{size:"small",class:G(e(k).custom_background?"glasscard smallcard":"")},{header:_(()=>[t("div",Qe,[t("span",Ye,u(e(l)("cs_helper.group.lv81_90")),1)])]),default:_(()=>[t("div",Ze,[(p(!0),x(O,null,P(s.group2Items,(d,i)=>(p(),C(X,{class:"item",key:`item-${i}`,"item-info":e(S)(d),value:n.value.free.itemSelected[d],"onUpdate:value":j=>n.value.free.itemSelected[d]=j},null,8,["item-info","value","onUpdate:value"]))),128))])]),_:2},1032,["class"])]),t("div",He,[c(z,{icon:e(A),text:e(l)("workflow.text.join_in_workflow"),tip:e(l)("workflow.text.join_selected_collectable_submissions_in_workflow"),onClick:f},null,8,["icon","text","tip"]),c(z,{icon:e(pe),text:e(l)("common.clear"),tip:e(l)("cs_helper.tooltip.clear_selected"),onClick:D},null,8,["icon","text","tip"])])]),_:2},1032,["name","disabled"]))),128))]),_:1},8,["value"])])]),_:1})]),_:1},8,["value"])]),_:1})])])}}}),et=Q(Ke,[["__scopeId","data-v-37e6b654"]]),tt={id:"main-container"},st={id:"left-layout"},at={id:"right-layout"},rt=T({__name:"CollectableSubmissionsPage",setup(q){const L=I("t"),l=I("userConfig"),k=I("appMode")??W(""),$=ne(),M=ce(),{calItems:n}=ue(),o=W(F());if(!(l.value.disable_workstate_cache??!1)){const r=l.value.cshelper_cache_work_state;r&&JSON.stringify(r).length>2&&(o.value=F(r)),Z(o,async()=>{if(o.value&&l)try{await Promise.resolve(),l.value.cshelper_cache_work_state=o.value,$.setUserConfig(l.value)}catch(s){console.error("Error handling workState change:",s)}else console.warn("workState or userConfig is not defined")},{deep:!0})}(()=>{Object.keys(U).forEach(r=>{o.value.free.itemSelected[Number(r)]??=0})})();const f=y(()=>{let r=0,s=0;o.value.target.greater.item&&(r=U[o.value.target.greater.item].rewards[2][1]),o.value.target.lesser.item&&(s=U[o.value.target.lesser.item].rewards[2][1]);let d=0,i=0;return o.value.target.greater.scrip&&(r?d=Math.ceil(o.value.target.greater.scrip/r):d="???"),o.value.target.lesser.scrip&&(s?i=Math.ceil(o.value.target.lesser.scrip/s):i="???"),{requireGreater:d,requireLesser:i}}),b=y(()=>{if(o.value.mode==="target"){const r={};return o.value.target.greater.item&&f.value.requireGreater&&f.value.requireGreater!=="???"&&(r[o.value.target.greater.item]=f.value.requireGreater),o.value.target.lesser.item&&f.value.requireLesser&&f.value.requireLesser!=="???"&&(r[o.value.target.lesser.item]=f.value.requireLesser),r}else return o.value.mode==="free"?o.value.free.itemSelected:(console.warn("unset mode!"),{})}),a=y(()=>n(b.value)),v=W(!1),g=y(()=>{const r={};return Object.values(a.value.ls).forEach(s=>{r[s.id]=s.need}),r}),h=()=>{if(!Object.values(g.value).length){M.error(L("workflow.join_in_workflow.message.no_colleactable_submission"));return}v.value=!0};return(r,s)=>{const d=_e;return p(),x("div",tt,[H(c(ee,{id:"router-card","page-name":e(L)("common.appfunc.cshelper"),"page-icon":e(ve)},null,8,["page-name","page-icon"]),[[K,e(k)!=="overlay"]]),t("div",st,[c(et,{"work-state":e(o),"onUpdate:workState":s[0]||(s[0]=i=>V(o)?o.value=i:null),"target-data":e(f),onJoinWorkflow:h},null,8,["work-state","target-data"])]),t("div",at,[c(me,{"hide-precraft-materials":e(o).hidePrecraftMaterials,"onUpdate:hidePrecraftMaterials":s[1]||(s[1]=i=>e(o).hidePrecraftMaterials=i),statistics:e(a),"item-selected":e(b)},null,8,["hide-precraft-materials","statistics","item-selected"])]),c(de,{show:e(v),"onUpdate:show":s[2]||(s[2]=i=>V(v)?v.value=i:null),items:e(g)},null,8,["show","items"]),c(d)])}}}),dt=Q(rt,[["__scopeId","data-v-1c80a58f"]]);export{dt as default};
