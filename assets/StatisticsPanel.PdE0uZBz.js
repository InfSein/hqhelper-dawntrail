import{q as V,S as L,e as B,f as O,h as T,r as $,s as G,F as Q,t as W,v as X,w as Z,x as H,y as J,z as K,A as Y}from"./index.Cask5RuP.js";import{d as A,W as E,k as g,r as f,X as k,c as q,o as U,S as i,Q as e,e as P,R as y,a as r,U as w,x,Z as b,N as ee}from"./vendor.Bn-7_sVg.js";import{C as te}from"./CraftStatistics.B9m63Ejw.js";const se={class:"item-selector"},ae=A({__name:"ItemStepper",props:E({itemInfo:{type:Object,required:!0}},{value:{required:!0},valueModifiers:{}}),emits:["update:value"],setup(l){const a=g("isMobile")??f(!1),m=k(l,"value");return(c,d)=>(U(),q("div",se,[i(V,{class:"item-button","item-info":l.itemInfo,"show-icon":"","show-name":"","btn-height":30,"pop-use-custom-width":"","pop-custom-width":e(a)?300:void 0},null,8,["item-info","pop-custom-width"]),i(L,{class:"item-stepper",value:m.value,"onUpdate:value":d[0]||(d[0]=S=>m.value=S)},null,8,["value"])]))}}),fe=B(ae,[["__scopeId","data-v-14be2278"]]),oe={class:"card-title-text"},ie=["disabled"],ne={class:"pre"},re={class:"preset-item"},le=A({__name:"StatisticsPanel",props:E({itemSelected:{},statistics:{}},{hidePrecraftMaterials:{type:Boolean,required:!0},hidePrecraftMaterialsModifiers:{}}),emits:["update:hidePrecraftMaterials"],setup(l){const a=g("t"),m=g("userConfig"),c=g("funcConfig"),d=O(),{alertError:S}=Y(a),j=T(),{getStatementData:D}=$(m,c,a),F=l,C=k(l,"hidePrecraftMaterials"),p=f(!1),v=f(!1),N=()=>{c.value.use_traditional_statement?p.value=!0:v.value=!0},n=P(()=>D(F.statistics)),h=f(!1),M=P(()=>G(c.value,n.value)),u=f(!1),z=async()=>{if(M.value.updateRequired){u.value=!0;try{const o=[];n.value.craftTargets.forEach(s=>{o.push(s.id)}),n.value.materialsLvBase.forEach(s=>{o.push(s.id)});const t=await J([...new Set(o)],c.value.universalis_server),_=c.value;Object.keys(t).forEach(s=>{const I=Number(s);_.cache_item_prices[I]=t[I]}),await d.setFuncConfig(K(_,d.userConfig))}catch(o){console.error(o),await S(a("common.message.get_price_failed")+`
`+(o?.message??o))}u.value=!1}},R=async()=>{if(u.value){j.info(a("common.loading"));return}await z(),h.value=!0};return(o,t)=>{const _=W;return U(),q("div",null,[i(Q,{"card-key":"ft-statistics"},{header:y(()=>[t[4]||(t[4]=r("i",{class:"xiv square-2"},null,-1)),r("span",oe,w(e(a)("statistics.view_statistics")),1),r("a",{class:"card-title-extra",href:"javascript:void(0);",onClick:N},w(e(a)("common.mquoted_view_statement")),1),r("a",{class:"card-title-extra",href:"javascript:void(0);",disabled:e(u),style:ee(e(u)?"cursor: not-allowed; color: gray;":"cursor: pointer;"),onClick:R},"["+w(e(u)?e(a)("common.loading"):e(a)("statistics.group.cost_and_benefit.title"))+"]",13,ie)]),default:y(()=>[r("div",ne,[r("div",re,[i(_,{value:C.value,"onUpdate:value":t[0]||(t[0]=s=>C.value=s),round:!1,size:"small"},null,8,["value"]),r("div",null,w(e(a)("statistics.preference.show_direct_materials_only")),1)])]),i(te,{"item-selected":l.itemSelected,"hide-precraft-materials":C.value},null,8,["item-selected","hide-precraft-materials"]),i(X,x({show:e(p),"onUpdate:show":t[1]||(t[1]=s=>b(p)?p.value=s:null)},e(n)),null,16,["show"]),i(Z,x({show:e(v),"onUpdate:show":t[2]||(t[2]=s=>b(v)?v.value=s:null)},e(n)),null,16,["show"]),i(H,{show:e(h),"onUpdate:show":t[3]||(t[3]=s=>b(h)?h.value=s:null),"cost-items":e(n).materialsLvBase,"benefit-items":e(n).craftTargets,"cost-info":e(M).costInfo,"benefit-info":e(M).benefitInfo},null,8,["show","cost-items","benefit-items","cost-info","benefit-info"])]),_:1})])}}}),me=B(le,[["__scopeId","data-v-0bc93f0e"]]);export{fe as I,me as S};
