import{aB as ne,at as te,bK as le,c as ye,au as re,f as ie,h as ke,i as Ce,ca as xe,aQ as Ue,av as Se,aY as ze,cb as Ie,b3 as Ae}from"./index.DIpgTaJR.js";import{aR as ce,z as ue,a as Me,E as Fe,P as Le,aS as Ne,aT as $e,aU as K,aV as ae,aW as oe,aX as Ve,aY as se,aZ as Be}from"./icons._F9tMcs6.js";import{d as de,k as D,X as W,r as C,e as N,P as X,o as y,Q as e,R as l,a as t,c as $,Y as Oe,U as s,F as Te,n as v,V as c,W as Ee,j,S as Re,N as Q,Z as je}from"./vendor.DOOPojup.js";const De={class:"wrapper",ref:"wrapper"},Pe={class:"modal-submit-container"},qe=de({__name:"ModalNbbAvatarSelector",props:{show:{type:Boolean,required:!0},showModifiers:{},avatarId:{required:!0},avatarIdModifiers:{}},emits:["update:show","update:avatarId"],setup(A){const a=D("t"),w=W(A,"show"),M=W(A,"avatarId"),b=C(0),u=N(()=>{const U=[64350,64351,64460,64463,64465],S=[];return S.push(...Array.from({length:142},(z,p)=>p+64326).filter(z=>!U.includes(z))),S}),P=()=>{b.value=M.value||64384},q=x=>{b.value===x?V():b.value=x},V=()=>{M.value=b.value,w.value=!1};return(x,F)=>{const U=te,S=re,z=ne;return y(),X(z,{show:w.value,"onUpdate:show":F[0]||(F[0]=p=>w.value=p),icon:e(ce),title:e(a)("cloud.text.select_avatar"),"max-width":"500px",onOnLoad:P},{action:l(()=>[t("div",Pe,[s(U,{type:"primary",size:"large",onClick:V},{icon:l(()=>[s(S,null,{default:l(()=>[s(e(ue))]),_:1})]),default:l(()=>[v(" "+c(e(a)("common.confirm")),1)]),_:1})])]),default:l(()=>[t("div",De,[(y(!0),$(Te,null,Oe(e(u),p=>(y(),X(U,{key:`avatar-${p}`,type:e(b)===p?"primary":"default",class:"avatar-button",title:p,onClick:Z=>q(p)},{default:l(()=>[s(ye,{src:e(le)(p),size:36},null,8,["src"])]),_:2},1032,["type","title","onClick"]))),128))],512)]),_:1},8,["show","icon","title"])}}}),Ye=ie(qe,[["__scopeId","data-v-7ecd9a4b"]]),Ke={class:"wrapper"},Qe={key:0,class:"login-panel"},We={class:"form-container"},Xe={class:"form-label"},Ze={class:"form-label"},Ge={class:"sub-links"},He={key:1,class:"register-panel"},Je={class:"form-container"},ea={class:"form-label"},aa={class:"form-label"},oa={class:"form-label"},sa={class:"form-label"},na={class:"form-label"},ta={class:"sub-links"},la={key:2,class:"resetpass-panel"},ra={class:"form-container"},ia={class:"form-label"},ca={class:"form-label"},ua={class:"form-label"},da={class:"sub-links"},ma={key:3,class:"edituser-panel"},_a={class:"form-container"},va={class:"form-label"},pa={class:"form-label"},fa={class:"form-label"},ga={class:"avatar-edit-container"},wa={class:"modal-submit-container"},ba=de({__name:"ModalLogin",props:Ee({defaultTab:{}},{show:{type:Boolean,required:!0},showModifiers:{}}),emits:["update:show"],setup(A){const a=D("t"),w=D("cloudConfig"),M=D("appForceUpdate")??(()=>{}),b=ke(),u=Ce(),{sendVerify:P,sendVerifyForResetPassword:q,register:V,login:x,resetPassword:F,resolveUserInfo:U,resetNickNameAndTitle:S,resetAvatar:z}=xe(w),p=W(A,"show"),Z=A,_=C("login"),B=C(0),L=C(!1),I=C(!1),O=C(!1),T=C(!1),h=j({account:"",password:""}),d=j({email:"",nickname:"",loginname:"",password:"",verifycode:""}),g=j({email:"",password:"",verifycode:""}),m=j({nickname:"",title:"",avatar:0}),me=()=>{_.value=Z.defaultTab,m.nickname=w.value.nbb_account_nickname,m.title=w.value.nbb_account_title,m.avatar=w.value.nbb_account_avatar},_e=N(()=>{switch(_.value){case"resetpass":return Ne;case"register":return Le;case"edituser":return Fe;case"login":default:return Me}}),ve=N(()=>{switch(_.value){case"resetpass":return a("cloud.text.reset_password");case"register":return a("common.register");case"edituser":return a("cloud.text.edit_account_info");case"login":default:return a("common.login")}}),G=N(()=>L.value?a("cloud.message.verify_cooldown",B.value):a("cloud.text.send_verify")),pe=N(()=>{const r=m.avatar||64384;return le(r)}),fe=r=>{B.value=r,L.value=!0;const o=setInterval(()=>{B.value--,B.value<=0&&(clearInterval(o),L.value=!1)},1e3)},Y=(r,o,i)=>r.replace(/[\u4e00-\u9fa5]/g,"aa").length>o?a("cloud.message.key_is_too_long",{key:i}):"",E=(r,o="",i="",f=!0)=>{if(r.errno){let k="";i&&(k+=i),f&&(k+=r.errmsg),u.error(k)}else{const k=o||a("cloud.message.operate_succeed");u.success(k)}},H=r=>{const o=U(r,w.value);b.setCloudConfig(o),M()},J=async r=>{if(r){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)){u.error(a("cloud.message.email_format_wrong"));return}}else{u.error(a("common.message.please_input_val",a("common.email")));return}I.value=!0;const o=_.value==="resetpass"?q:P;try{const i=await o(r);E(i,a("cloud.message.verify_sent")),i.errno||fe(60)}catch(i){u.error(a("cloud.message.verify_send_failed",i.message)),console.error(`Send verify failed:
`,i)}finally{I.value=!1}},ge=()=>{T.value=!0},we=async()=>{try{if(O.value=!0,_.value==="login"){if(h.account){if(!h.password){u.error(a("common.message.please_input_val",a("common.password")));return}}else{u.error(a("common.message.please_input_val",a("common.account")));return}const r=await x(h.account,h.password);E(r,a("cloud.message.login_succeed")),r.errno||(H(r.data),p.value=!1)}else if(_.value==="register"){if(d.email)if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email))if(d.verifycode)if(d.loginname)if(d.nickname){if(!d.password){u.error(a("common.message.please_input_val",a("common.password")));return}}else{u.error(a("common.message.please_input_val",a("common.nickname")));return}else{u.error(a("common.message.please_input_val",a("common.login_name")));return}else{u.error(a("common.message.please_input_val",a("common.verify_code")));return}else{u.error(a("cloud.message.email_format_wrong"));return}else{u.error(a("common.message.please_input_val",a("common.email")));return}const r=Y(d.nickname,12,a("common.nickname"));if(r){u.error(r);return}const o=await V(d.email,d.nickname,d.loginname,d.password,d.verifycode);E(o,a("cloud.message.register_succeed")),o.errno||(H(o.data),p.value=!1)}else if(_.value==="resetpass"){if(g.email)if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g.email))if(g.verifycode){if(!g.password){u.error(a("common.message.please_input_val",a("common.password")));return}}else{u.error(a("common.message.please_input_val",a("common.verify_code")));return}else{u.error(a("cloud.message.email_format_wrong"));return}else{u.error(a("common.message.please_input_val",a("common.email")));return}const r=await F(g.email,g.password,g.verifycode);E(r,a("cloud.message.reset_password_succeed")),r.errno||(_.value="login")}else if(_.value==="edituser"){if(!m.nickname){u.error(a("common.message.please_input_val",a("common.nickname")));return}const r=Y(m.nickname,12,a("common.nickname"))||Y(m.title,20,a("cloud.text.user_title"));if(r){u.error(r);return}const o=Ae(w.value);if(m.nickname!==w.value.nbb_account_nickname||m.title!==w.value.nbb_account_title){const i=await S(m.nickname,m.title);if(i.errno){u.error(a("cloud.message.reset_nick_or_title_failed",i.errmsg));return}else o.nbb_account_nickname=m.nickname,o.nbb_account_title=m.title,b.setCloudConfig(o)}if(m.avatar!==w.value.nbb_account_avatar){const i=await z(m.avatar);if(i.errno){u.error(a("cloud.message.reset_avatar_failed",i.errmsg));return}else o.nbb_account_avatar=m.avatar,b.setCloudConfig(o)}M(),p.value=!1}else console.error("Unexpected loginAction",_.value)}catch(r){u.error(a("cloud.message.submit_failed",r.message)),console.error(`Submit failed:
`,r)}finally{O.value=!1}};return(r,o)=>{const i=re,f=Ue,k=Se,R=te,ee=ze,be=Ie,he=ne;return y(),X(he,{show:p.value,"onUpdate:show":o[20]||(o[20]=n=>p.value=n),"max-width":"500px",icon:e(_e),title:e(ve),onOnLoad:me},{action:l(()=>[t("div",wa,[s(R,{type:"primary",size:"large",loading:e(O),disabled:e(O),onClick:we},{icon:l(()=>[s(i,null,{default:l(()=>[s(e(ue))]),_:1})]),default:l(()=>[v(" "+c(e(a)("common.confirm")),1)]),_:1},8,["loading","disabled"])])]),default:l(()=>[t("div",Ke,[e(_)==="login"?(y(),$("div",Qe,[t("div",We,[t("div",Xe,[s(i,{size:15},{default:l(()=>[s(e($e))]),_:1}),v(" "+c(e(a)("common.account")),1)]),s(f,{value:e(h).account,"onUpdate:value":o[0]||(o[0]=n=>e(h).account=n),placeholder:e(a)("cloud.message.please_input_loginname_or_email")},null,8,["value","placeholder"]),t("div",Ze,[s(i,{size:15},{default:l(()=>[s(e(K))]),_:1}),v(" "+c(e(a)("common.password")),1)]),s(f,{type:"password",value:e(h).password,"onUpdate:value":o[1]||(o[1]=n=>e(h).password=n),"show-password-on":"click",placeholder:e(a)("common.message.please_input_val",e(a)("common.password"))},null,8,["value","placeholder"])]),t("div",Ge,[t("a",{href:"javascript:void(0);",onClick:o[2]||(o[2]=n=>_.value="register")},c(e(a)("cloud.text.register_account")),1),s(k,{vertical:""}),t("a",{href:"javascript:void(0);",onClick:o[3]||(o[3]=n=>_.value="resetpass")},c(e(a)("cloud.text.forgot_password")),1)])])):e(_)==="register"?(y(),$("div",He,[t("div",Je,[t("div",ea,[s(i,{size:15},{default:l(()=>[s(e(ae))]),_:1}),v(" "+c(e(a)("common.email")),1)]),s(f,{value:e(d).email,"onUpdate:value":o[4]||(o[4]=n=>e(d).email=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.email"))},null,8,["value","placeholder"]),t("div",aa,[s(i,{size:15},{default:l(()=>[s(e(oe))]),_:1}),v(" "+c(e(a)("common.verify_code")),1)]),s(ee,null,{default:l(()=>[s(f,{value:e(d).verifycode,"onUpdate:value":o[5]||(o[5]=n=>e(d).verifycode=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.verify_code"))},null,8,["value","placeholder"]),s(R,{type:"info",disabled:e(L)||e(I),loading:e(I),onClick:o[6]||(o[6]=n=>J(e(d).email))},{default:l(()=>[v(c(e(G)),1)]),_:1},8,["disabled","loading"])]),_:1}),t("div",oa,[s(i,{size:15},{default:l(()=>[s(e(Ve))]),_:1}),v(" "+c(e(a)("common.login_name")),1)]),s(f,{value:e(d).loginname,"onUpdate:value":o[7]||(o[7]=n=>e(d).loginname=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.login_name"))},null,8,["value","placeholder"]),t("div",sa,[s(i,{size:15},{default:l(()=>[s(e(se))]),_:1}),v(" "+c(e(a)("common.nickname")),1)]),s(f,{value:e(d).nickname,"onUpdate:value":o[8]||(o[8]=n=>e(d).nickname=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.nickname")),"show-count":"",clearable:""},{count:l(({value:n})=>[t("span",{style:Q(n.replace(/[\u4e00-\u9fa5]/g,"aa").length>12?"color: var(--color-error);":"")},c(n.replace(/[\u4e00-\u9fa5]/g,"aa").length+" / 12"),5)]),_:1},8,["value","placeholder"]),t("div",na,[s(i,{size:15},{default:l(()=>[s(e(K))]),_:1}),v(" "+c(e(a)("common.password")),1)]),s(f,{value:e(d).password,"onUpdate:value":o[9]||(o[9]=n=>e(d).password=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.password"))},null,8,["value","placeholder"])]),t("div",ta,[t("div",null,c(e(a)("cloud.text.do_you_have_an_account")),1),t("a",{href:"javascript:void(0);",onClick:o[10]||(o[10]=n=>_.value="login")},c(e(a)("cloud.text.click_here_to_login")),1)])])):e(_)==="resetpass"?(y(),$("div",la,[t("div",ra,[t("div",ia,[s(i,{size:15},{default:l(()=>[s(e(ae))]),_:1}),v(" "+c(e(a)("common.email")),1)]),s(f,{value:e(g).email,"onUpdate:value":o[11]||(o[11]=n=>e(g).email=n),placeholder:e(a)("cloud.text.please_input_email_when_registered")},null,8,["value","placeholder"]),t("div",ca,[s(i,{size:15},{default:l(()=>[s(e(oe))]),_:1}),v(" "+c(e(a)("common.verify_code")),1)]),s(ee,null,{default:l(()=>[s(f,{value:e(g).verifycode,"onUpdate:value":o[12]||(o[12]=n=>e(g).verifycode=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.verify_code"))},null,8,["value","placeholder"]),s(R,{type:"info",disabled:e(L)||e(I),loading:e(I),onClick:o[13]||(o[13]=n=>J(e(g).email))},{default:l(()=>[v(c(e(G)),1)]),_:1},8,["disabled","loading"])]),_:1}),t("div",ua,[s(i,{size:15},{default:l(()=>[s(e(K))]),_:1}),v(" "+c(e(a)("cloud.text.new_password")),1)]),s(f,{value:e(g).password,"onUpdate:value":o[14]||(o[14]=n=>e(g).password=n),placeholder:e(a)("cloud.text.please_input_new_password")},null,8,["value","placeholder"])]),t("div",da,[t("a",{href:"javascript:void(0);",onClick:o[15]||(o[15]=n=>_.value="login")},c(e(a)("cloud.text.back_to_login")),1)])])):e(_)==="edituser"?(y(),$("div",ma,[t("div",_a,[t("div",va,[s(i,{size:15},{default:l(()=>[s(e(se))]),_:1}),v(" "+c(e(a)("common.nickname")),1)]),s(f,{value:e(m).nickname,"onUpdate:value":o[16]||(o[16]=n=>e(m).nickname=n),placeholder:e(a)("common.message.please_input_val",e(a)("common.nickname")),"show-count":"",clearable:""},{count:l(({value:n})=>[t("span",{style:Q(n.replace(/[\u4e00-\u9fa5]/g,"aa").length>12?"color: var(--color-error);":"")},c(n.replace(/[\u4e00-\u9fa5]/g,"aa").length+" / 12"),5)]),_:1},8,["value","placeholder"]),t("div",pa,[s(i,{size:15},{default:l(()=>[s(e(Be))]),_:1}),v(" "+c(e(a)("cloud.text.user_title")),1)]),s(f,{value:e(m).title,"onUpdate:value":o[17]||(o[17]=n=>e(m).title=n),placeholder:e(a)("common.message.please_input_val",e(a)("cloud.text.user_title")),"show-count":"",clearable:""},{count:l(({value:n})=>[t("span",{style:Q(n.replace(/[\u4e00-\u9fa5]/g,"aa").length>20?"color: var(--color-error);":"")},c(n.replace(/[\u4e00-\u9fa5]/g,"aa").length+" / 20"),5)]),_:1},8,["value","placeholder"]),t("div",fa,[s(i,{size:15},{default:l(()=>[s(e(ce))]),_:1}),v(" "+c(e(a)("cloud.text.avatar")),1)]),t("div",ga,[s(be,{size:48,src:e(pe),class:"button-avatar"},null,8,["src"]),s(R,{size:"small",onClick:ge},{default:l(()=>[v(c(e(a)("common.edit")),1)]),_:1})])])])):Re("",!0)]),s(Ye,{show:e(T),"onUpdate:show":o[18]||(o[18]=n=>je(T)?T.value=n:null),"avatar-id":e(m).avatar,"onUpdate:avatarId":o[19]||(o[19]=n=>e(m).avatar=n)},null,8,["show","avatar-id"])]),_:1},8,["show","icon","title"])}}}),Ca=ie(ba,[["__scopeId","data-v-a09c52ca"]]);export{Ca as default};
