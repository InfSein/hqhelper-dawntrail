import{f as N,u as U,aV as I,aW as F,g as R,r as G,b1 as V,i as j,b3 as A,e as J}from"./index.DjNjFiam.js";import{d as M,r as k,e as n,k as f,w,c as O,U as h,Q as m,o as Q}from"./vendor.DaGD8wRy.js";import"./icons.BN6_TYLH.js";const q={id:"main-container",class:"wrapper"},z=M({__name:"WorkflowProcessPage",setup(H){const v=f("t"),r=f("userConfig"),d=f("funcConfig"),x=N(),{emitSync:C,onSync:D}=F(),{calItems:b}=U(),{getStatementData:S,getProStatementData:B,calRecommProcessData:P,calRecommProcessGroups:y}=G(r,d,v),l=k(I()),t=n(()=>l.value.workflows[l.value.currentWorkflow]),i=k(!1);if(!(r.value.disable_workstate_cache??!1)){const a=r.value.workflow_cache_work_state;a&&JSON.stringify(a).length>2&&(l.value=I(a)),w(l,async()=>{if(l.value&&r)try{if(await Promise.resolve(),i.value){i.value=!1;return}r.value.workflow_cache_work_state=l.value,x.setUserConfig(r.value),C("workflowStateChanged",A(r.value))}catch(s){console.error("Error handling workState change:",s)}else console.warn("workState or userConfig is not defined")},{deep:!0})}D("workflowStateChanged",a=>{i.value=!0,l.value=a.workflow_cache_work_state});const L=n(()=>{const a=[];for(const s in t.value.targetItems){const c=Number(s),e=t.value.targetItems[c];if(e>0){const o=R(c);o.amount=e,a.push(o)}}return a}),E=n(()=>b(t.value.targetItems)),W=n(()=>S(E.value)),p=n(()=>B(L.value,t.value.preparedItems)),T=n(()=>P(p.value.targetItemsForCal,p.value.lv1ItemsForCal,p.value.baseItemsForCal)),u=n(()=>{const{craftTargets:a,lv1Items:s,lv2Items:c,lv3Items:e,lvBaseItems:o}=T.value;return y(a,s,c,e,o,d.value.processes_craftable_item_sortby,d.value.processes_merge_gatherings,r.value.language_ui,v)}),_=()=>{const{craftTargets:a,materialsLv1:s,materialsLvBase:c}=W.value;a.forEach(e=>{const o=t.value.preparedItems.craftTarget[e.id];o?o>e.amount&&(t.value.preparedItems.craftTarget[e.id]=e.amount):t.value.preparedItems.craftTarget[e.id]=0}),s.forEach(e=>{const o=t.value.preparedItems.materialsLv1[e.id];o?o>e.amount&&(t.value.preparedItems.materialsLv1[e.id]=e.amount):t.value.preparedItems.materialsLv1[e.id]=0}),c.forEach(e=>{const o=t.value.preparedItems.materialsLvBase[e.id];o?o>e.amount&&(t.value.preparedItems.materialsLvBase[e.id]=e.amount):t.value.preparedItems.materialsLvBase[e.id]=0})},g=()=>{for(let a=0;a<u.value.length;a++)t.value.recommData.expandedBlocks[a]||(t.value.recommData.expandedBlocks[a]=["1"]),t.value.recommData.completedItems[a]||(t.value.recommData.completedItems[a]={}),u.value[a].items.forEach(s=>{t.value.recommData.completedItems[a][s.id]||(t.value.recommData.completedItems[a][s.id]=!1)})};return w(u,async()=>{g(),_()}),g(),_(),(a,s)=>{const c=j;return Q(),O("div",q,[h(V,{"expanded-blocks":m(t).recommData.expandedBlocks,"onUpdate:expandedBlocks":s[0]||(s[0]=e=>m(t).recommData.expandedBlocks=e),"completed-items":m(t).recommData.completedItems,"onUpdate:completedItems":s[1]||(s[1]=e=>m(t).recommData.completedItems=e),"item-groups":m(u),"content-max-height":"auto","content-max-width":"auto"},null,8,["expanded-blocks","completed-items","item-groups"]),h(c)])}}}),$=J(z,[["__scopeId","data-v-b2c9c003"]]);export{$ as default};
